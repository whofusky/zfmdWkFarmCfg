


    ===============================================================
        防火墙配置脚本使用说明    孙建军    2019.1.23
                                  傅世凯@2019.5.17修改

    ===============================================================


--------------------------------------------------------------------------------
使用说明：
--------------------

    第一步：按项目现场网络配置编辑cfg/network.conf配置文件

        注意：
        编辑时请注意格式，不要插入不必要的空格、不可见字符等。
        配置项说明详见“配置文件中各配置项说明”一节。

    第二步：把包中文件复制到各台服务器上（共5台，视是否需要设置而布置相应主机）
        1，以root用户登录到操作系统；
        2，复制本文件包中文件到“/zfmd/wpfs20/safe”文件夹；
        3，复制或修改正确的network.conf到“/zfmd/wpfs20/safe/fw/cfg”文件夹；
        4，在“/zfmd/wpfs20/safe/fw”文件夹中打开一个终端窗口并执行下面命令；
        chmod u+x opfw

    第三步：在各台服务器上执行脚本完成防火墙设置
        1，以root用户登录到操作系统；
        2，在“/zfmd/wpfs20/safe/fw”文件夹中打开一个终端窗口并执行下面命令；
            1) echo $HOSTNAME
                根据出现的主机名是否为如下之一：
                    MeteoServer PredictServer1 PredictServer2 ScadaServer WorkStation
                如果当前主机名不在上面的范围之内，需要【停止后面步骤的操作】并联系相关人员进行脚本修改再进行以后的步骤
            2)./opfw
                根据出现的提示信息进行选择相应的操作即可
        3，检查执行结果是否正确，或拍照回传确认；

    第四步：观察各服务器软件通信是否正常


    其他：脚本提供了对防火墙的一些操作，执行方法同上。
        1，在本机永久打开防火墙
            ./opfw 然后根据提示输入1

        2，在本机永久停用防火墙
            ./opfw 然后根据提示输入2

        3，查看本机防火墙
            ./opfw 然后根据提示输入4


--------------------------------------------------------------------------------

===============================================================
配置文件中部分配置项说明：

    配置中凡是端口的配置都遵循的规则：
    --------------------------------------------->
    (1)可配单个端口号
    (2)可配连续的端口号但需要用-线连接如 1024-65535
    (3)可配多个不连接端口号用，号分隔如 20,21,1024-65535
    <---------------------------------------------


    配置中凡是需要配置多个ip对的时候，都遵循同样的规则：
    --------------------------------------------->
    所有的ip地址对需要用英文输入法中半角状态的双引号"括起来
           每个ip地址对的基本格式为:  "本地ip/远程ip"
           多个ip地址对用 | 隔开，中间可以有换行或空格
          
          每个ip后如果有端口号则格式为 "ip:端口"
          如果端口号是一个范围则配置为 "ip:端口1-端口2"
          ip地址对中可以只有端口号但端口号之前的:不能省略
    
    <---------------------------------------------


    配置文件中共用开关配置说明：
    --------------------------------------------->
        debugFlag=1
            1 只输出将要配置的信息不实际写入系统；
            0 除了输出正常的信息，还将信息写入系统,非调试状态【应该】使用此值

        enablePing=1
            1 开启ping功能
            0 关闭ping功能

        enInterSsh=1
            1 开启内网ip之间的ssh端口(因此气象服务器是一定不会开启的)
            0 不开启

        bindNICByIP=1
            1 根据配置的本地ip自动找对应的网卡号并进行绑定;
            0 不绑定


    <---------------------------------------------
          

    1，TIME_PORT
        校时服务使用的端口号
        各服务器校时服务使用的端口号（包括监听端口）必须都在此范围内。
        例如以下设置表示校时使用6801到6809的端口：
        TIME_PORT=6801-6809

    2，DC_PORT
        数据中心软件使用的监听端口。
        例如以下设置表示数据中心使用9009监听端口：
        DC_PORT=9009

    3，WEB_PORT
        JAVA平台软件使用的监听端口。
        例如以下设置表示JAVA平台软件使用8080监听端口：
        WEB_PORT=8080

    4，AUDIT_IP和AUDIT_PORT
        日志审计、网络安全管理等审计功能使用的IP和端口。
        例如以下设置表示连接100.110.120.50服务器的8800、8801监听端口来上报审计信息：
        AUDIT_IP=100.110.120.50
        AUDIT_PORT=8800-8801

    5，METEO1_IP和METEO2_IP
        气象服务器从云平台下载数据的两个IP。
        例如以下设置表示从42.121.65.50和182.254.227.250下载场外数据：
        METEO1_IP=42.121.65.50
        METEO2_IP=182.254.227.250

    6，MS_BID_NIC1和MS_BID_NIC2
        气象服务器连接反隔的两块网卡的接口名称。
        例如以下设置代表气象服务器操作系统eth1和eth2网卡连接反隔：
        MS_BID_NIC1=eth1
        MS_BID_NIC2=eth2

    7，WS_IP
        工作站的内网IP。
        例如以下设置代表工作站的内网IP为100.110.120.40
        WS_IP=100.110.120.40

    8，WS_CLIENTS
        工作站上提供的其他多个客户端TCP连接。
        格式参照上面提到的ip地址对的说明

    9，PS1_IP
        主预测服务器的内网IP。
        例如以下设置代表主预测服务器的内网IP为100.110.120.20：
        PS1_IP=100.110.120.20

    10，PS1_BID_NIC
        主预测服务器连接反隔的网卡的接口名称。
        例如以下设置代表主预测服务器操作系统eth3网卡连接反隔：
        PS1_BID_NIC=eth3

    11，PS1_SERVERS
        主预测服务器上提供的其他多个服务端TCP连接。

    12，PS1_CLIENTS
        主预测服务器上提供的其他多个客户端TCP连接。
     
    13，PS2_IP
        备预测服务器的内网IP。
        例如以下设置代表备预测服务器的内网IP为100.110.120.30：
        PS2_IP=100.110.120.30

    14，PS2_BID_NIC
        备预测服务器连接反隔的网卡的接口名称。
        例如以下设置代表备预测服务器操作系统eth5网卡连接反隔：
        PS2_BID_NIC=eth5

    15，PS2_SERVERS
        备预测服务器上提供的其他多个服务端TCP连接。

    16，PS2_CLIENTS
        备预测服务器上提供的其他多个客户端TCP连接。

    17，SCADA_IP
        SCADA服务器的内网IP。
        例如以下设置代表SCADA服务器的内网IP为100.110.120.10：
        SCADA_IP=100.110.120.10

    18，SCADA_SERVERS
        SCADA服务器上提供的其他多个服务端TCP连接。

    19，SCADA_CLIENTS
        SCADA服务器上提供的其他多个客户端TCP连接。

--------------------------------------------------------------------------------



